<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P.A.T.R.I.C.I.A - Advanced Psychometric Assessment</title>
    <meta name="description" content="Comprehensive personality assessment integrating Big Five, HEXACO, neurodiversity screening, and cognitive profiling">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root {
            --neural-blue: #6B9BD1;
            --neural-purple: #A584B7;
            --neural-teal: #5EBAA0;
            --neural-coral: #F09090;
            --neural-gold: #E5B055;
            --neural-green: #6FAE8D;
            
            --bg-primary: #1A1F2E;
            --bg-secondary: #242937;
            --bg-tertiary: #2D3344;
            --bg-card: #363D52;
            
            --text-primary: #E0E4EA;
            --text-secondary: #B8C0D0;
            --text-tertiary: #8B95A8;
            
            --border-color: #3D4556;
            --border-active: #7BA7D7;
            
            --success: #6FAE8D;
            --warning: #E5B055;
            --error: #D68585;
            --info: #7BA7D7;
        }

        [data-theme="light"] {
            --neural-blue: #8BADD3;
            --neural-purple: #B199C4;
            --neural-teal: #7DC5B3;
            --neural-coral: #F5A8A8;
            --neural-gold: #E8C078;
            --neural-green: #8BBAA5;
            
            --bg-primary: #FDF9F5;
            --bg-secondary: #FAF6F2;
            --bg-tertiary: #F5F0EA;
            --bg-card: #FFFFFF;
            
            --text-primary: #3D3D3D;
            --text-secondary: #5D5D5D;
            --text-tertiary: #7D7D7D;
            
            --border-color: #E8E2DA;
            --border-active: #9BBDDA;
            
            --success: #8BBAA5;
            --warning: #E8C078;
            --error: #E5A0A0;
            --info: #9BBDDA;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Neural Network Background Animation */
        .neural-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.03;
            pointer-events: none;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border-radius: 20px;
            padding: 3rem;
            margin-bottom: 3rem;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, var(--neural-purple) 0%, transparent 70%);
            opacity: 0.1;
            animation: pulse 8s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.1; }
            50% { transform: scale(1.1); opacity: 0.15; }
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--neural-blue) 0%, var(--neural-purple) 50%, var(--neural-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            letter-spacing: -0.02em;
        }

        .header .subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            max-width: 600px;
        }

        /* Progress System */
        .progress-container {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            position: relative;
            transition: all 0.3s ease;
        }
        
        .progress-container.minimized {
            padding: 0.5rem 1rem;
        }
        
        .progress-container.minimized .progress-stats,
        .progress-container.minimized .progress-bar {
            display: none;
        }
        
        .progress-toggle {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.4rem 0.8rem;
            cursor: pointer;
            font-size: 0.85rem;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .progress-toggle:hover {
            background: var(--bg-card);
            color: var(--text-primary);
            border-color: var(--border-active);
        }
        
        .progress-toggle-icon {
            transition: transform 0.3s ease;
        }
        
        .progress-container.minimized .progress-toggle-icon {
            transform: rotate(180deg);
        }
        
        .progress-minimized-text {
            display: none;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .progress-container.minimized .progress-minimized-text {
            display: inline;
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .progress-stat {
            text-align: center;
        }

        .progress-stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--neural-blue);
        }

        .progress-stat-label {
            font-size: 0.875rem;
            color: var(--text-tertiary);
        }

        .progress-bar {
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neural-blue) 0%, var(--neural-purple) 50%, var(--neural-teal) 100%);
            border-radius: 10px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Assessment Container */
        .assessment-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Mobile Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
                max-width: 100%;
            }
            
            .header {
                padding: 1.5rem;
                margin-bottom: 1.5rem;
            }
            
            .header h1 {
                font-size: 1.75rem;
                line-height: 1.2;
            }
            
            .header .subtitle {
                font-size: 1rem;
            }
            
            .assessment-card {
                padding: 1.25rem;
                border-radius: 15px;
            }
            
            .progress-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }
            
            .progress-stat {
                padding: 0.75rem;
            }
            
            .option-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .visual-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.6rem;
            }
            
            .visual-option {
                padding: 0.75rem 0.5rem;
                font-size: 0.8rem;
            }
            
            .visual-option .emoji {
                font-size: 1.5rem;
            }
            
            .frequency-grid {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .frequency-grid table {
                min-width: 500px;
            }
            
            .question-text {
                font-size: 1.1rem;
                line-height: 1.4;
            }
            
            .question-instruction {
                font-size: 0.9rem;
                color: var(--text-secondary);
                margin-top: 0.5rem;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .nav-button {
                width: 100%;
                padding: 1rem;
            }
            
            .slider-container {
                padding: 1rem 0;
            }
            
            .time-options {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }
            
            .scenario-option {
                padding: 1rem;
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 480px) {
            .visual-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .progress-toggle {
                padding: 0.3rem 0.6rem;
                font-size: 0.8rem;
            }
            
            .header h1 {
                font-size: 1.4rem;
            }
            
            .time-options {
                grid-template-columns: 1fr;
            }
            
            .progress-stats {
                grid-template-columns: 1fr;
            }
            
            .question-text {
                font-size: 1rem;
            }
        }
        
        /* Touch-friendly interactions */
        @media (hover: none) and (pointer: coarse) {
            .visual-option,
            .scenario-option,
            .time-option,
            .nav-button {
                -webkit-tap-highlight-color: transparent;
            }
            
            .visual-option:active,
            .scenario-option:active {
                transform: scale(0.98);
            }
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .question-number {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border-radius: 10px;
            font-weight: 600;
            color: var(--neural-blue);
        }

        .question-category {
            padding: 0.25rem 0.75rem;
            background: var(--neural-purple);
            background: linear-gradient(135deg, var(--neural-purple) 0%, var(--neural-blue) 100%);
            border-radius: 20px;
            font-size: 0.875rem;
            color: white;
        }

        .question-text {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2rem;
            line-height: 1.4;
        }

        /* Question Types */
        
        /* Visual Grid */
        .visual-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
        }

        .visual-option {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .visual-option::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, var(--neural-blue) 0%, transparent 70%);
            transition: all 0.5s ease;
            transform: translate(-50%, -50%);
        }

        .visual-option:hover {
            transform: translateY(-2px);
            border-color: var(--neural-blue);
        }

        .visual-option.selected {
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.1) 0%, rgba(155, 89, 182, 0.1) 100%);
            border-color: var(--neural-blue);
        }

        .visual-option.selected::before {
            width: 200%;
            height: 200%;
            opacity: 0.1;
        }

        .visual-emoji {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .visual-text {
            font-weight: 500;
            color: var(--text-secondary);
        }

        /* Slider */
        .slider-container {
            padding: 2rem 0;
        }

        .slider-track {
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            position: relative;
            margin: 2rem 0;
        }

        .slider-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neural-blue) 0%, var(--neural-purple) 100%);
            border-radius: 3px;
            width: 50%;
            transition: width 0.3s ease;
        }

        .slider-handle {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 24px;
            height: 24px;
            background: white;
            border: 3px solid var(--neural-blue);
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .slider-handle:active {
            cursor: grabbing;
            transform: translate(-50%, -50%) scale(1.1);
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            color: var(--text-tertiary);
        }

        .slider-value {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--neural-blue);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
        }

        /* Frequency Grid */
        .frequency-grid {
            overflow-x: auto;
        }

        .frequency-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .frequency-table th,
        .frequency-table td {
            padding: 1rem;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .frequency-table th {
            background: var(--bg-secondary);
            font-weight: 600;
            color: var(--text-secondary);
        }

        .frequency-table td:first-child {
            text-align: left;
            font-weight: 500;
        }

        .frequency-option {
            display: inline-block;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .frequency-option:hover {
            transform: scale(1.1);
            background: var(--neural-blue);
        }

        .frequency-option.selected {
            background: var(--neural-blue);
            box-shadow: 0 0 20px rgba(74, 144, 226, 0.5);
        }

        .frequency-option.selected::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
        }

        /* Time Preference */
        .time-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .time-option {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .time-option:hover {
            border-color: var(--neural-teal);
            transform: translateY(-2px);
        }

        .time-option.selected {
            background: linear-gradient(135deg, rgba(26, 188, 156, 0.1) 0%, rgba(74, 144, 226, 0.1) 100%);
            border-color: var(--neural-teal);
        }

        .time-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        /* Task Ranking */
        .ranking-container {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 1rem;
        }

        .ranking-item {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 1rem;
            margin: 0.5rem 0;
            cursor: move;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s ease;
        }

        .ranking-item:hover {
            transform: translateX(5px);
            border-color: var(--neural-purple);
        }

        .ranking-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .ranking-number {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--neural-blue) 0%, var(--neural-purple) 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .ranking-text {
            flex: 1;
            font-weight: 500;
        }

        .ranking-handle {
            color: var(--text-tertiary);
            font-size: 1.25rem;
        }

        /* Body Mapping */
        .body-map {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            background: var(--bg-secondary);
            border-radius: 15px;
            position: relative;
        }

        .body-svg {
            width: 300px;
            height: 400px;
        }

        .body-part {
            fill: var(--bg-tertiary);
            stroke: var(--border-color);
            stroke-width: 2;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .body-part:hover {
            fill: rgba(74, 144, 226, 0.2);
            stroke: var(--neural-blue);
        }

        .body-part.selected {
            fill: rgba(255, 107, 107, 0.3);
            stroke: var(--neural-coral);
            animation: throb 1.5s ease-in-out infinite;
        }

        @keyframes throb {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Results Section */
        .results-container {
            display: none;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .results-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .results-title {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--neural-blue) 0%, var(--neural-purple) 50%, var(--neural-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .profile-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .profile-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--neural-blue) 0%, var(--neural-purple) 50%, var(--neural-teal) 100%);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .profile-emoji {
            font-size: 4rem;
            background: var(--bg-secondary);
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            border: 2px solid var(--border-color);
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 2rem;
            font-weight: 700;
            color: var(--neural-blue);
            margin-bottom: 0.5rem;
        }

        .profile-description {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Trait Visualization */
        .traits-visualization {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .trait-bars {
            display: grid;
            gap: 1.5rem;
        }

        .trait-bar {
            display: grid;
            grid-template-columns: 150px 1fr 60px;
            align-items: center;
            gap: 1rem;
        }

        .trait-name {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .trait-progress {
            height: 12px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .trait-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .trait-fill.high {
            background: linear-gradient(90deg, var(--neural-green) 0%, var(--neural-teal) 100%);
        }

        .trait-fill.medium {
            background: linear-gradient(90deg, var(--neural-blue) 0%, var(--neural-purple) 100%);
        }

        .trait-fill.low {
            background: linear-gradient(90deg, var(--neural-gold) 0%, var(--neural-coral) 100%);
        }

        .trait-score {
            font-weight: 700;
            color: var(--text-primary);
            text-align: right;
        }

        /* Neurodiversity Indicators */
        .neuro-indicators {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .neuro-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .neuro-indicator {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            position: relative;
        }

        .neuro-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .neuro-label {
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .neuro-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .neuro-value.high {
            color: var(--neural-coral);
        }

        .neuro-value.medium {
            color: var(--neural-gold);
        }

        .neuro-value.low {
            color: var(--neural-green);
        }

        /* Detailed Analysis Tabs */
        .analysis-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .tab-button {
            padding: 0.75rem 1.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab-button:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .tab-button.active {
            background: linear-gradient(135deg, var(--neural-blue) 0%, var(--neural-purple) 100%);
            color: white;
            border-color: transparent;
        }

        .tab-content {
            display: none;
            animation: slideUp 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        .analysis-section {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .analysis-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--neural-blue);
            margin-bottom: 1rem;
        }

        .analysis-content {
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .insight-list {
            list-style: none;
            padding: 0;
        }

        .insight-item {
            padding: 1rem;
            margin: 0.5rem 0;
            background: var(--bg-secondary);
            border-left: 4px solid var(--neural-blue);
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .insight-item:hover {
            transform: translateX(5px);
            background: var(--bg-tertiary);
        }

        /* Achievement System */
        .achievements {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .achievement {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .achievement.unlocked {
            border-color: var(--neural-gold);
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.1) 0%, rgba(241, 196, 15, 0.1) 100%);
        }

        .achievement.unlocked::before {
            content: '✨';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 1rem;
        }

        .achievement-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            filter: grayscale(1);
            opacity: 0.3;
        }

        .achievement.unlocked .achievement-icon {
            filter: grayscale(0);
            opacity: 1;
        }

        .achievement-name {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-tertiary);
        }

        .achievement.unlocked .achievement-name {
            color: var(--neural-gold);
        }

        /* Buttons */
        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--neural-blue) 0%, var(--neural-purple) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(74, 144, 226, 0.3);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
            border-color: var(--neural-blue);
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        /* Loading State */
        .loading-container {
            display: none;
            text-align: center;
            padding: 4rem;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            margin: 0 auto 2rem;
            border: 4px solid var(--bg-tertiary);
            border-top: 4px solid var(--neural-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .loading-subtext {
            color: var(--text-tertiary);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .visual-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .trait-bar {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 1000;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            border-color: var(--neural-blue);
        }

        .theme-icon {
            font-size: 1.5rem;
        }
    </style>
</head>
<body>
    <!-- Neural Network Background -->
    <canvas class="neural-bg" id="neuralCanvas"></canvas>
    
    <!-- Theme Toggle -->
    <div class="theme-toggle" id="themeToggle">
        <span class="theme-icon">🌙</span>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>P.A.T.R.I.C.I.A</h1>
                <p class="subtitle">
                    Psychometric Assessment Tool for Research-based Individual Character & Insight Analysis
                    <br><small>Integrating Big Five, HEXACO, neurodiversity screening, and cognitive profiling</small>
                </p>
            </div>
        </header>

        <!-- Progress Container -->
        <div class="progress-container" id="progressContainer" style="display: none;">
            <button class="progress-toggle" id="progressToggle" onclick="toggleProgress()" title="Toggle progress display">
                <span class="progress-toggle-icon">▼</span>
                <span id="toggleText">Hide</span>
            </button>
            <span class="progress-minimized-text" id="minimizedText">Progress tracking minimized • Click to expand</span>
            <div class="progress-stats">
                <div class="progress-stat">
                    <div class="progress-stat-value" id="questionNumber">0</div>
                    <div class="progress-stat-label">Current Question</div>
                </div>
                <div class="progress-stat">
                    <div class="progress-stat-value" id="totalQuestions">0</div>
                    <div class="progress-stat-label">Total Questions</div>
                </div>
                <div class="progress-stat">
                    <div class="progress-stat-value" id="timeElapsed">0:00</div>
                    <div class="progress-stat-label">Time Elapsed</div>
                </div>
                <div class="progress-stat">
                    <div class="progress-stat-value" id="completionRate">0%</div>
                    <div class="progress-stat-label">Completion</div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill" id="progressBar"></div>
            </div>
        </div>

        <!-- Main Content Area -->
        <main id="mainContent">
            <!-- Welcome Screen -->
            <div id="welcomeScreen" class="assessment-card">
                <h2 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 1.5rem; background: linear-gradient(135deg, var(--neural-blue) 0%, var(--neural-purple) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    Welcome to Your Comprehensive Personality Assessment
                </h2>
                
                <p style="font-size: 1.125rem; color: var(--text-secondary); line-height: 1.8; margin-bottom: 2rem;">
                    This advanced assessment combines validated psychological measures including the Big Five personality model, 
                    HEXACO framework, neurodiversity indicators, and cognitive profiling to provide you with deep, 
                    personalized insights about your unique psychological profile.
                </p>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                    <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 15px; border-left: 4px solid var(--neural-blue);">
                        <h3 style="color: var(--neural-blue); margin-bottom: 0.5rem;">🧠 What We Measure</h3>
                        <ul style="list-style: none; padding: 0; color: var(--text-secondary);">
                            <li>✓ Personality dimensions & facets</li>
                            <li>✓ Neurodivergent traits & patterns</li>
                            <li>✓ Cognitive processing styles</li>
                            <li>✓ Emotional regulation patterns</li>
                            <li>✓ Social & sensory profiles</li>
                        </ul>
                    </div>
                    
                    <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 15px; border-left: 4px solid var(--neural-purple);">
                        <h3 style="color: var(--neural-purple); margin-bottom: 0.5rem;">🎮 Interactive Experience</h3>
                        <ul style="list-style: none; padding: 0; color: var(--text-secondary);">
                            <li>✓ Diverse question formats</li>
                            <li>✓ Visual & interactive elements</li>
                            <li>✓ Gamified progress tracking</li>
                            <li>✓ Achievement system</li>
                            <li>✓ Adaptive questioning</li>
                        </ul>
                    </div>
                    
                    <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 15px; border-left: 4px solid var(--neural-teal);">
                        <h3 style="color: var(--neural-teal); margin-bottom: 0.5rem;">📊 Your Results</h3>
                        <ul style="list-style: none; padding: 0; color: var(--text-secondary);">
                            <li>✓ Detailed personality profile</li>
                            <li>✓ Neurodiversity indicators</li>
                            <li>✓ Strengths & growth areas</li>
                            <li>✓ Career & relationship insights</li>
                            <li>✓ Personalized recommendations</li>
                        </ul>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, rgba(74, 144, 226, 0.1) 0%, rgba(155, 89, 182, 0.1) 100%); padding: 1.5rem; border-radius: 15px; margin-bottom: 2rem;">
                    <p style="color: var(--text-primary); font-weight: 500; margin-bottom: 0.5rem;">
                        ⏱️ Estimated time: 15-20 minutes
                    </p>
                    <p style="color: var(--text-secondary); margin: 0;">
                        This assessment is designed to be engaging and insightful. Take your time and answer honestly - 
                        there are no right or wrong answers, only your unique patterns and preferences.
                    </p>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="startAssessment()">
                        <span>Begin Your Journey</span>
                        <span>→</span>
                    </button>
                </div>
            </div>

            <!-- Assessment Questions -->
            <div id="assessmentContainer" style="display: none;">
                <!-- Questions will be dynamically inserted here -->
            </div>

            <!-- Loading Screen -->
            <div id="loadingScreen" class="loading-container">
                <div class="loading-spinner"></div>
                <div class="loading-text">Analyzing your responses...</div>
                <div class="loading-subtext">Creating your personalized profile</div>
            </div>

            <!-- Results -->
            <div id="resultsContainer" class="results-container">
                <!-- Results will be dynamically inserted here -->
            </div>
        </main>
    </div>

    <script>
        // Embedded personality profiles data
        const personalityProfiles = [
            {
                id: 'analytical_architect',
                name: 'The Analytical Architect',
                emoji: '🏗️',
                description: 'Systematic thinkers who build understanding through careful analysis and structured approaches.',
                detailedAnalysis: {
                    core: 'Your mind operates like a sophisticated blueprint system, constructing understanding through methodical analysis and logical frameworks.',
                    strengths: [
                        'Exceptional pattern recognition in data and systems',
                        'Strong analytical and critical thinking abilities',
                        'Natural talent for optimization and efficiency',
                        'Detail-oriented approach catches what others miss',
                        'Excellent at creating and following systematic processes'
                    ],
                    growth: 'Balance your analytical strengths with intuitive exploration. Practice making "good enough" decisions when perfection isn\'t necessary.',
                    relationships: 'You value intellectual connection and clear communication. Partners who appreciate your thoughtful approach will be most compatible.',
                    career: ['Data Scientist', 'Software Architect', 'Research Analyst', 'Financial Analyst', 'Systems Engineer'],
                    communication: 'Direct, precise, and fact-based. You prefer written communication for complex topics.'
                },
                traits: {
                    openness: { score: 75 },
                    conscientiousness: { score: 88 },
                    extraversion: { score: 32 },
                    agreeableness: { score: 58 },
                    neuroticism: { score: 42 },
                    honestyHumility: 78
                },
                neurodivergent: {
                    autismTraits: 65,
                    adhdTraits: 25,
                    sensitivity: 55,
                    executiveFunction: 85
                }
            },
            {
                id: 'creative_visionary',
                name: 'The Creative Visionary',
                emoji: '🎨',
                description: 'Imaginative innovators who see possibilities others miss and bring creative solutions to life.',
                detailedAnalysis: {
                    core: 'Your mind is a kaleidoscope of possibilities, constantly generating novel connections and creative solutions.',
                    strengths: [
                        'Exceptional creative and divergent thinking',
                        'Natural ability to see unconventional solutions',
                        'Strong aesthetic sense and artistic appreciation',
                        'Excellent at brainstorming and ideation',
                        'Adaptable and comfortable with ambiguity'
                    ],
                    growth: 'Channel your creativity through structured projects. Develop systems to capture and implement your ideas effectively.',
                    relationships: 'You need partners who appreciate your creativity and give you freedom to explore.',
                    career: ['Creative Director', 'UX Designer', 'Innovation Consultant', 'Artist', 'Writer', 'Entrepreneur'],
                    communication: 'Metaphorical, enthusiastic, and idea-focused. You excel at visual and storytelling communication.'
                },
                traits: {
                    openness: { score: 92 },
                    conscientiousness: { score: 52 },
                    extraversion: { score: 68 },
                    agreeableness: { score: 72 },
                    neuroticism: { score: 58 },
                    honestyHumility: 70
                },
                neurodivergent: {
                    autismTraits: 45,
                    adhdTraits: 70,
                    sensitivity: 80,
                    executiveFunction: 45
                }
            },
            {
                id: 'social_orchestrator',
                name: 'The Social Orchestrator',
                emoji: '🎭',
                description: 'Natural connectors who bring people together and create harmonious social environments.',
                detailedAnalysis: {
                    core: 'You possess an intuitive understanding of social dynamics and excel at creating connections between people.',
                    strengths: [
                        'Exceptional interpersonal and communication skills',
                        'Natural empathy and emotional attunement',
                        'Strong leadership through collaboration',
                        'Excellent at building and maintaining networks',
                        'Skilled at conflict resolution and mediation'
                    ],
                    growth: 'Set boundaries to protect your energy. Practice assertiveness and prioritize self-care.',
                    relationships: 'You thrive in emotionally connected, communicative relationships.',
                    career: ['HR Director', 'Community Manager', 'Therapist', 'Event Coordinator', 'Public Relations'],
                    communication: 'Warm, inclusive, and emotionally expressive. You excel at verbal communication.'
                },
                traits: {
                    openness: { score: 68 },
                    conscientiousness: { score: 72 },
                    extraversion: { score: 88 },
                    agreeableness: { score: 85 },
                    neuroticism: { score: 48 },
                    honestyHumility: 82
                },
                neurodivergent: {
                    autismTraits: 20,
                    adhdTraits: 35,
                    sensitivity: 75,
                    executiveFunction: 65
                }
            },
            {
                id: 'strategic_commander',
                name: 'The Strategic Commander',
                emoji: '⚔️',
                description: 'Decisive leaders who combine vision with execution to achieve ambitious goals.',
                detailedAnalysis: {
                    core: 'You are a natural leader with a strategic mind and unwavering determination.',
                    strengths: [
                        'Strong leadership and decision-making abilities',
                        'Excellent strategic planning and execution',
                        'High achievement drive and goal orientation',
                        'Natural confidence and assertiveness',
                        'Skilled at resource optimization'
                    ],
                    growth: 'Develop emotional intelligence alongside strategic thinking. Practice patience.',
                    relationships: 'You need partners who are independent and share your ambition.',
                    career: ['CEO', 'Military Officer', 'Strategic Consultant', 'Entrepreneur', 'Investment Banker'],
                    communication: 'Direct, confident, and goal-focused. You prefer efficient communication.'
                },
                traits: {
                    openness: { score: 72 },
                    conscientiousness: { score: 90 },
                    extraversion: { score: 78 },
                    agreeableness: { score: 52 },
                    neuroticism: { score: 28 },
                    honestyHumility: 62
                },
                neurodivergent: {
                    autismTraits: 35,
                    adhdTraits: 45,
                    sensitivity: 30,
                    executiveFunction: 90
                }
            },
            {
                id: 'empathic_healer',
                name: 'The Empathic Healer',
                emoji: '💚',
                description: 'Deeply compassionate souls who intuitively understand and support others\' emotional journeys.',
                detailedAnalysis: {
                    core: 'You possess profound emotional depth and an intuitive understanding of others\' inner worlds.',
                    strengths: [
                        'Exceptional empathy and emotional intelligence',
                        'Natural counseling and healing abilities',
                        'Strong intuition about people\'s needs',
                        'Deep capacity for compassion',
                        'Excellent at creating safe spaces'
                    ],
                    growth: 'Learn to differentiate between your emotions and others\'. Develop protective boundaries.',
                    relationships: 'You need emotionally available, authentic partners who value depth.',
                    career: ['Therapist', 'Counselor', 'Nurse', 'Social Worker', 'Life Coach'],
                    communication: 'Gentle, validating, and emotionally attuned.'
                },
                traits: {
                    openness: { score: 78 },
                    conscientiousness: { score: 75 },
                    extraversion: { score: 58 },
                    agreeableness: { score: 92 },
                    neuroticism: { score: 55 },
                    honestyHumility: 88
                },
                neurodivergent: {
                    autismTraits: 30,
                    adhdTraits: 25,
                    sensitivity: 92,
                    executiveFunction: 60
                }
            },
            {
                id: 'pattern_weaver',
                name: 'The Pattern Weaver',
                emoji: '🕸️',
                description: 'System thinkers who see hidden connections and create order from complexity.',
                detailedAnalysis: {
                    core: 'Your mind excels at detecting patterns and connections that others miss.',
                    strengths: [
                        'Exceptional pattern recognition',
                        'Deep focus in areas of interest',
                        'Strong logical capabilities',
                        'Excellent specialized memory',
                        'Unique perspective'
                    ],
                    growth: 'Honor your need for structure while building flexibility.',
                    relationships: 'You thrive with partners who appreciate your unique perspective.',
                    career: ['Systems Analyst', 'Data Architect', 'Research Scientist', 'Software Developer'],
                    communication: 'Precise, detailed, and information-rich.'
                },
                traits: {
                    openness: { score: 82 },
                    conscientiousness: { score: 78 },
                    extraversion: { score: 28 },
                    agreeableness: { score: 62 },
                    neuroticism: { score: 65 },
                    honestyHumility: 85
                },
                neurodivergent: {
                    autismTraits: 85,
                    adhdTraits: 30,
                    sensitivity: 78,
                    executiveFunction: 55
                }
            },
            {
                id: 'dynamic_explorer',
                name: 'The Dynamic Explorer',
                emoji: '🚀',
                description: 'High-energy innovators who thrive on novelty and bring passionate intensity.',
                detailedAnalysis: {
                    core: 'Your mind craves stimulation and novelty, jumping between interests with enthusiasm.',
                    strengths: [
                        'High energy and enthusiasm',
                        'Creative problem-solving',
                        'Hyperfocus abilities',
                        'Excellent in crisis',
                        'Outside-the-box thinking'
                    ],
                    growth: 'Build external structures to support your internal variability.',
                    relationships: 'You need partners who can match your energy.',
                    career: ['Emergency Responder', 'Entrepreneur', 'Creative Director', 'Journalist'],
                    communication: 'Enthusiastic, fast-paced, and idea-jumping.'
                },
                traits: {
                    openness: { score: 85 },
                    conscientiousness: { score: 45 },
                    extraversion: { score: 82 },
                    agreeableness: { score: 65 },
                    neuroticism: { score: 62 },
                    honestyHumility: 65
                },
                neurodivergent: {
                    autismTraits: 25,
                    adhdTraits: 90,
                    sensitivity: 70,
                    executiveFunction: 35
                }
            },
            {
                id: 'sensory_sage',
                name: 'The Sensory Sage',
                emoji: '🌺',
                description: 'Highly sensitive perceivers who experience the world with extraordinary depth.',
                detailedAnalysis: {
                    core: 'You experience the world through a heightened sensory and emotional lens.',
                    strengths: [
                        'Extraordinary perception',
                        'Deep aesthetic appreciation',
                        'Strong intuition',
                        'Profound empathy',
                        'Subtle change detection'
                    ],
                    growth: 'Create environments that honor your sensitivity.',
                    relationships: 'You need gentle, understanding partners.',
                    career: ['Artist', 'Therapist', 'Writer', 'Designer', 'Musician'],
                    communication: 'Nuanced, thoughtful, and emotionally rich.'
                },
                traits: {
                    openness: { score: 88 },
                    conscientiousness: { score: 70 },
                    extraversion: { score: 35 },
                    agreeableness: { score: 82 },
                    neuroticism: { score: 68 },
                    honestyHumility: 82
                },
                neurodivergent: {
                    autismTraits: 40,
                    adhdTraits: 20,
                    sensitivity: 95,
                    executiveFunction: 60
                }
            },
            {
                id: 'resilient_phoenix',
                name: 'The Resilient Phoenix',
                emoji: '🔥',
                description: 'Transformation catalysts who turn challenges into growth.',
                detailedAnalysis: {
                    core: 'You have extraordinary capacity for transformation and renewal.',
                    strengths: [
                        'Exceptional resilience',
                        'Deep wisdom',
                        'Growth capacity',
                        'Inspirational presence',
                        'Crisis management'
                    ],
                    growth: 'Allow yourself to be vulnerable and receive support.',
                    relationships: 'You need partners who appreciate both strength and vulnerability.',
                    career: ['Life Coach', 'Trauma Therapist', 'Motivational Speaker', 'Social Entrepreneur'],
                    communication: 'Authentic, inspiring, and wisdom-filled.'
                },
                traits: {
                    openness: { score: 78 },
                    conscientiousness: { score: 75 },
                    extraversion: { score: 68 },
                    agreeableness: { score: 75 },
                    neuroticism: { score: 38 },
                    honestyHumility: 78
                },
                neurodivergent: {
                    autismTraits: 35,
                    adhdTraits: 45,
                    sensitivity: 70,
                    executiveFunction: 75
                }
            }
        ];

        // Research-based psychological assessment with validated measures
        // Based on: NEO-PI-R, HEXACO-PI-R, RAADS-R, AQ-10, ASRS, BRIEF-A, Dark Triad
        const assessmentQuestions = [
            // === BASELINE & EMOTIONAL CALIBRATION ===
            {
                id: 'baseline_affect',
                type: 'visual_grid',
                category: 'emotional_baseline',
                text: 'Which emotions resonate with you right now?',
                instruction: 'Select all that apply - this calibrates the assessment to your current state',
                options: [
                    { emoji: '⚡', text: 'Energized', value: 'positive_activation' },
                    { emoji: '🌊', text: 'Calm', value: 'positive_deactivation' },
                    { emoji: '🔥', text: 'Passionate', value: 'engaged_motivated' },
                    { emoji: '❄️', text: 'Detached', value: 'negative_deactivation' },
                    { emoji: '🌪️', text: 'Restless', value: 'negative_activation' },
                    { emoji: '🌱', text: 'Hopeful', value: 'positive_future' },
                    { emoji: '🏔️', text: 'Grounded', value: 'centered_present' },
                    { emoji: '🌫️', text: 'Unclear', value: 'confused_uncertain' }
                ],
                multiSelect: true,
                research: 'PANAS (Watson et al., 1988)'
            },
            
            // Cognitive Processing Style (Dual Process Theory - Kahneman)
            {
                id: 'cognitive_style',
                type: 'scenario',
                category: 'cognitive_processing',
                text: 'You need to make an important decision. What\'s your first instinct?',
                instruction: 'Think about how you naturally approach complex choices',
                options: [
                    { text: 'Trust my gut feeling immediately', value: 7, trait: 'intuitive' },
                    { text: 'Quick mental pros/cons, then decide', value: 5, trait: 'balanced' },
                    { text: 'Research thoroughly before choosing', value: 3, trait: 'analytical' },
                    { text: 'Ask trusted people for their input', value: 4, trait: 'social' }
                ],
                research: 'System 1/2 thinking (Kahneman, 2011)'
            },
            
            // Social Energy Patterns (NEO-PI-R Extraversion Facets)
            {
                id: 'social_energy',
                type: 'slider',
                category: 'extraversion',
                text: 'After intense social interaction, your energy feels...',
                instruction: 'Think about how you feel after a busy social event',
                min: 1,
                max: 7,
                labels: ['Completely depleted', 'Balanced', 'Fully recharged'],
                research: 'Extraversion energy hypothesis (Lucas et al., 2000)'
            },
            
            // Behavioral Activation System (Gray's BIS/BAS)
            {
                id: 'reward_sensitivity',
                type: 'scenario',
                category: 'extraversion',
                text: 'You see an opportunity that excites you but has risks. You:',
                instruction: 'Consider your typical response to exciting possibilities',
                options: [
                    { text: 'Jump in immediately - the excitement is worth it!', value: 7, trait: 'high_BAS' },
                    { text: 'Feel excited but need time to consider', value: 5, trait: 'moderate_BAS' },
                    { text: 'Carefully weigh all risks first', value: 3, trait: 'high_BIS' },
                    { text: 'Usually pass - not worth the potential downsides', value: 1, trait: 'avoidant' }
                ],
                research: 'BIS/BAS scales (Carver & White, 1994)'
            },
            
            // Social Processing Speed (Based on social cognition research)
            {
                id: 'social_processing',
                type: 'visual_grid',
                category: 'extraversion',
                text: 'In group conversations, which describes you best?',
                options: [
                    { emoji: '💭', text: 'Think first', value: 'internal_processing' },
                    { emoji: '🗣️', text: 'Think aloud', value: 'external_processing' },
                    { emoji: '👂', text: 'Listen mostly', value: 'receptive' },
                    { emoji: '🎯', text: 'Direct flow', value: 'leadership' },
                    { emoji: '🔄', text: 'Adapt quickly', value: 'flexible' },
                    { emoji: '⏸️', text: 'Need pauses', value: 'reflective' }
                ],
                multiSelect: false,
                research: 'Social information processing (Crick & Dodge, 1994)'
            },
            
            // Big Five: Openness
            {
                id: 'ocean_o1',
                type: 'scenario',
                category: 'openness',
                text: 'You discover a hidden door in your home. Your first instinct is to:',
                options: [
                    { text: 'Immediately explore every corner', value: 7 },
                    { text: 'Cautiously investigate', value: 5 },
                    { text: 'Research the house history first', value: 4 },
                    { text: 'Call someone else to check', value: 2 }
                ]
            },
            {
                id: 'ocean_o2',
                type: 'visual_grid',
                category: 'openness',
                text: 'Which activities appeal to you most? Select all:',
                options: [
                    { emoji: '🎨', text: 'Art/Creating', value: 'creative' },
                    { emoji: '📚', text: 'Philosophy', value: 'abstract' },
                    { emoji: '🗺️', text: 'Exploring', value: 'adventure' },
                    { emoji: '🔬', text: 'Experimenting', value: 'curious' },
                    { emoji: '🎭', text: 'Performing', value: 'expressive' },
                    { emoji: '🧩', text: 'Puzzles', value: 'analytical' },
                    { emoji: '📖', text: 'Stories', value: 'imaginative' },
                    { emoji: '🏛️', text: 'History', value: 'traditional' }
                ],
                multiSelect: true
            },
            {
                id: 'ocean_o3',
                type: 'slider',
                category: 'openness',
                text: 'How comfortable are you with ambiguity and uncertainty?',
                min: 1,
                max: 7,
                labels: ['Very uncomfortable', 'Neutral', 'Very comfortable']
            },
            
            // Big Five: Conscientiousness
            {
                id: 'ocean_c1',
                type: 'time_preference',
                category: 'conscientiousness',
                text: 'When do you typically arrive for appointments?',
                options: [
                    { text: '15+ min early', value: 7, icon: '⏰' },
                    { text: '5-10 min early', value: 6, icon: '✅' },
                    { text: 'Exactly on time', value: 5, icon: '🎯' },
                    { text: '5 min late', value: 3, icon: '😅' },
                    { text: 'Time is fluid', value: 1, icon: '🌊' }
                ]
            },
            {
                id: 'ocean_c2',
                type: 'scenario',
                category: 'conscientiousness',
                text: 'Your workspace typically looks like:',
                options: [
                    { text: 'Everything has its exact place', value: 7 },
                    { text: 'Generally organized with some clutter', value: 5 },
                    { text: 'Organized chaos - I know where things are', value: 3 },
                    { text: 'Free-form creative space', value: 1 }
                ]
            },
            {
                id: 'ocean_c3',
                type: 'slider',
                category: 'conscientiousness',
                text: 'How closely do you follow through on plans you make?',
                min: 1,
                max: 7,
                labels: ['Rarely follow through', 'Sometimes', 'Always complete']
            },
            
            // Big Five: Agreeableness
            {
                id: 'ocean_a1',
                type: 'scenario',
                category: 'agreeableness',
                text: 'A stranger asks for help with directions. You:',
                options: [
                    { text: 'Walk them to their destination', value: 7 },
                    { text: 'Give detailed directions with alternatives', value: 6 },
                    { text: 'Point them in the general direction', value: 4 },
                    { text: 'Say you\'re too busy to help', value: 2 }
                ]
            },
            {
                id: 'ocean_a2',
                type: 'slider',
                category: 'agreeableness',
                text: 'In conflicts, you tend to:',
                min: 1,
                max: 7,
                labels: ['Stand your ground firmly', 'Seek middle ground', 'Avoid at all costs']
            },
            {
                id: 'ocean_a3',
                type: 'visual_grid',
                category: 'agreeableness',
                text: 'How do you typically respond to others\' success?',
                options: [
                    { emoji: '🎉', text: 'Celebrate', value: 'supportive' },
                    { emoji: '👏', text: 'Congratulate', value: 'positive' },
                    { emoji: '😐', text: 'Neutral', value: 'indifferent' },
                    { emoji: '🤔', text: 'Analyze', value: 'comparative' },
                    { emoji: '😤', text: 'Competitive', value: 'motivated' },
                    { emoji: '😒', text: 'Skeptical', value: 'critical' }
                ],
                multiSelect: false
            },
            
            // Big Five: Neuroticism
            {
                id: 'ocean_n1',
                type: 'slider',
                category: 'neuroticism',
                text: 'How often do you worry about things beyond your control?',
                min: 1,
                max: 7,
                labels: ['Never', 'Sometimes', 'Constantly']
            },
            {
                id: 'ocean_n2',
                type: 'scenario',
                category: 'neuroticism',
                text: 'You make a minor mistake at work. Your reaction:',
                options: [
                    { text: 'Laugh it off and move on', value: 1 },
                    { text: 'Fix it and forget about it', value: 3 },
                    { text: 'Feel embarrassed for a while', value: 5 },
                    { text: 'Replay it in your mind for days', value: 7 }
                ]
            },
            {
                id: 'ocean_n3',
                type: 'frequency_grid',
                category: 'neuroticism',
                text: 'How often do you experience these?',
                items: [
                    'Mood swings',
                    'Anxiety about future',
                    'Self-doubt',
                    'Emotional overwhelm'
                ],
                scale: ['Never', 'Rarely', 'Sometimes', 'Often', 'Always']
            },
            
            // HEXACO: Honesty-Humility
            {
                id: 'hexaco_h1',
                type: 'scenario',
                category: 'honesty_humility',
                text: 'You find a wallet with $500 cash. You:',
                options: [
                    { text: 'Return everything immediately', value: 7 },
                    { text: 'Return wallet, consider keeping some cash', value: 4 },
                    { text: 'Keep the cash, return the wallet', value: 2 },
                    { text: 'Keep everything', value: 1 }
                ]
            },
            {
                id: 'hexaco_h2',
                type: 'slider',
                category: 'honesty_humility',
                text: 'How comfortable are you with self-promotion?',
                min: 1,
                max: 7,
                labels: ['Very uncomfortable', 'Balanced', 'Very comfortable']
            },
            
            // Neurodiversity: ADHD
            {
                id: 'adhd_1',
                type: 'frequency_grid',
                category: 'adhd_attention',
                text: 'How often do these happen to you?',
                items: [
                    'Start projects without finishing',
                    'Lose track of time when engaged',
                    'Forget appointments',
                    'Difficulty sitting still',
                    'Interrupt others'
                ],
                scale: ['Never', 'Rarely', 'Sometimes', 'Often', 'Always']
            },
            {
                id: 'adhd_2',
                type: 'scenario',
                category: 'adhd_hyperactivity',
                text: 'During a long meeting, you:',
                options: [
                    { text: 'Sit still and focus throughout', value: 1 },
                    { text: 'Fidget a little but stay engaged', value: 3 },
                    { text: 'Need to move, doodle, or fidget constantly', value: 5 },
                    { text: 'Feel like you might explode if you can\'t move', value: 7 }
                ]
            },
            
            // Neurodiversity: Autism Spectrum
            {
                id: 'asd_1',
                type: 'scenario',
                category: 'asd_social',
                text: 'At a work gathering, a colleague makes a joke everyone laughs at. You:',
                options: [
                    { text: 'Laugh naturally', value: 1 },
                    { text: 'Smile because others are', value: 3 },
                    { text: 'Analyze why it\'s funny', value: 5 },
                    { text: 'Feel confused but pretend', value: 7 }
                ]
            },
            {
                id: 'asd_2',
                type: 'visual_grid',
                category: 'asd_sensory',
                text: 'Which sensory experiences bother you? Select all:',
                options: [
                    { emoji: '🔊', text: 'Loud noises', value: 'auditory' },
                    { emoji: '💡', text: 'Bright lights', value: 'visual' },
                    { emoji: '👕', text: 'Clothing tags', value: 'tactile' },
                    { emoji: '🍽️', text: 'Food textures', value: 'oral' },
                    { emoji: '👃', text: 'Strong smells', value: 'olfactory' },
                    { emoji: '🏃', text: 'Sudden movement', value: 'vestibular' }
                ],
                multiSelect: true
            },
            {
                id: 'asd_3',
                type: 'slider',
                category: 'asd_routine',
                text: 'How do you feel when your routine is disrupted?',
                min: 1,
                max: 7,
                labels: ['Totally fine', 'Slightly bothered', 'Very distressed']
            },
            
            // High Sensitivity
            {
                id: 'hsp_1',
                type: 'slider',
                category: 'sensitivity',
                text: 'How intensely do you experience emotions compared to others?',
                min: 1,
                max: 10,
                labels: ['Much less', 'Similar', 'Much more']
            },
            {
                id: 'hsp_2',
                type: 'scenario',
                category: 'sensitivity',
                text: 'After a busy, stimulating day, you need:',
                options: [
                    { text: 'More stimulation - go out!', value: 1 },
                    { text: 'A quiet evening with friends', value: 3 },
                    { text: 'Complete solitude and darkness', value: 5 },
                    { text: 'Days to fully recover', value: 7 }
                ]
            },
            
            // Executive Function
            {
                id: 'ef_1',
                type: 'task_ranking',
                category: 'executive_function',
                text: 'Rank these from easiest to hardest:',
                items: [
                    'Starting projects',
                    'Finishing projects',
                    'Task switching',
                    'Organizing workspace',
                    'Following schedule'
                ]
            },
            {
                id: 'ef_2',
                type: 'frequency_grid',
                category: 'executive_function',
                text: 'How often do you struggle with:',
                items: [
                    'Prioritizing tasks',
                    'Time management',
                    'Decision making',
                    'Working memory'
                ],
                scale: ['Never', 'Rarely', 'Sometimes', 'Often', 'Always']
            },
            
            // Stress Response
            {
                id: 'stress_1',
                type: 'body_mapping',
                category: 'stress_response',
                text: 'Where do you typically feel stress in your body?',
                areas: ['head', 'neck', 'shoulders', 'chest', 'stomach', 'back', 'limbs']
            },
            {
                id: 'stress_2',
                type: 'scenario',
                category: 'stress_response',
                text: 'Under pressure, you tend to:',
                options: [
                    { text: 'Become hyper-focused and productive', value: 'active' },
                    { text: 'Feel energized but scattered', value: 'anxious' },
                    { text: 'Withdraw and need space', value: 'avoidant' },
                    { text: 'Seek support from others', value: 'social' }
                ]
            },
            
            // Values & Motivation
            {
                id: 'values_1',
                type: 'scenario',
                category: 'values',
                text: 'Which would you choose?',
                options: [
                    { text: 'High-paying job you dislike', value: 'security' },
                    { text: 'Lower-paying job you love', value: 'passion' }
                ]
            },
            {
                id: 'values_2',
                type: 'visual_grid',
                category: 'values',
                text: 'What motivates you most? Choose top 3:',
                options: [
                    { emoji: '🏆', text: 'Achievement', value: 'achievement' },
                    { emoji: '❤️', text: 'Relationships', value: 'connection' },
                    { emoji: '🎯', text: 'Growth', value: 'growth' },
                    { emoji: '🛡️', text: 'Security', value: 'security' },
                    { emoji: '🎨', text: 'Creativity', value: 'creativity' },
                    { emoji: '⚖️', text: 'Justice', value: 'justice' },
                    { emoji: '🌟', text: 'Recognition', value: 'recognition' },
                    { emoji: '🕊️', text: 'Peace', value: 'harmony' }
                ],
                multiSelect: true,
                maxSelect: 3
            }
        ];

        // Initialize assessment system
        let currentQuestionIndex = 0;
        let responses = {};
        let startTime = null;
        let questionStartTime = null;
        let timeElapsedInterval = null;
        let progressMinimized = false;
        
        // Toggle progress panel
        function toggleProgress() {
            const container = document.getElementById('progressContainer');
            const toggleText = document.getElementById('toggleText');
            
            progressMinimized = !progressMinimized;
            
            if (progressMinimized) {
                container.classList.add('minimized');
                toggleText.textContent = 'Show';
            } else {
                container.classList.remove('minimized');
                toggleText.textContent = 'Hide';
            }
            
            // Save preference to localStorage
            localStorage.setItem('progressMinimized', progressMinimized);
        }
        
        // Restore progress panel state on load
        function restoreProgressState() {
            const saved = localStorage.getItem('progressMinimized');
            if (saved === 'true') {
                progressMinimized = true;
                const container = document.getElementById('progressContainer');
                const toggleText = document.getElementById('toggleText');
                container.classList.add('minimized');
                toggleText.textContent = 'Show';
            }
        }
        let userProfile = null;

        // Initialize neural network background
        function initNeuralBackground() {
            const canvas = document.getElementById('neuralCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const nodes = [];
            const nodeCount = 50;
            
            for (let i = 0; i < nodeCount; i++) {
                nodes.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    radius: Math.random() * 2 + 1
                });
            }
            
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                nodes.forEach(node => {
                    node.x += node.vx;
                    node.y += node.vy;
                    
                    if (node.x < 0 || node.x > canvas.width) node.vx *= -1;
                    if (node.y < 0 || node.y > canvas.height) node.vy *= -1;
                });
                
                ctx.strokeStyle = 'rgba(74, 144, 226, 0.1)';
                ctx.lineWidth = 1;
                
                nodes.forEach((node1, i) => {
                    nodes.slice(i + 1).forEach(node2 => {
                        const distance = Math.hypot(node1.x - node2.x, node1.y - node2.y);
                        if (distance < 100) {
                            ctx.beginPath();
                            ctx.moveTo(node1.x, node1.y);
                            ctx.lineTo(node2.x, node2.y);
                            ctx.stroke();
                        }
                    });
                });
                
                ctx.fillStyle = 'rgba(74, 144, 226, 0.3)';
                nodes.forEach(node => {
                    ctx.beginPath();
                    ctx.arc(node.x, node.y, node.radius, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                requestAnimationFrame(animate);
            }
            
            animate();
        }

        // Theme toggle
        document.getElementById('themeToggle').addEventListener('click', function() {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', newTheme);
            this.querySelector('.theme-icon').textContent = newTheme === 'light' ? '☀️' : '🌙';
            localStorage.setItem('theme', newTheme);
        });

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.body.setAttribute('data-theme', savedTheme);
        document.querySelector('.theme-icon').textContent = savedTheme === 'light' ? '☀️' : '🌙';

        // Start assessment
        function startAssessment() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('assessmentContainer').style.display = 'block';
            document.getElementById('progressContainer').style.display = 'block';
            restoreProgressState();
            
            startTime = Date.now();
            questionStartTime = Date.now();
            
            document.getElementById('totalQuestions').textContent = assessmentQuestions.length;
            
            timeElapsedInterval = setInterval(updateTimeElapsed, 1000);
            
            showQuestion(0);
        }

        // Update time elapsed
        function updateTimeElapsed() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('timeElapsed').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // Show question
        function showQuestion(index) {
            if (index >= assessmentQuestions.length) {
                completeAssessment();
                return;
            }
            
            currentQuestionIndex = index;
            const question = assessmentQuestions[index];
            
            updateProgress();
            
            const container = document.getElementById('assessmentContainer');
            container.innerHTML = renderQuestion(question);
            
            initializeQuestionInteractions(question);
        }

        // Update progress
        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / assessmentQuestions.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('questionNumber').textContent = currentQuestionIndex + 1;
            document.getElementById('completionRate').textContent = `${Math.round(progress)}%`;
        }

        // Render question based on type
        function renderQuestion(question) {
            let html = `
                <div class="assessment-card">
                    <div class="question-header">
                        <div class="question-number">
                            <span>Question ${currentQuestionIndex + 1}</span>
                            <span>of ${assessmentQuestions.length}</span>
                        </div>
                        <div class="question-category">${question.category.replace(/_/g, ' ')}</div>
                    </div>
                    <div class="question-text">${question.text}</div>
                    ${question.instruction ? `<div class="question-instruction">${question.instruction}</div>` : ''}
                    <div class="question-content">
            `;
            
            switch(question.type) {
                case 'visual_grid':
                    html += renderVisualGrid(question);
                    break;
                case 'slider':
                    html += renderSlider(question);
                    break;
                case 'scenario':
                    html += renderScenario(question);
                    break;
                case 'frequency_grid':
                    html += renderFrequencyGrid(question);
                    break;
                case 'time_preference':
                    html += renderTimePreference(question);
                    break;
                case 'task_ranking':
                    html += renderTaskRanking(question);
                    break;
                case 'body_mapping':
                    html += renderBodyMapping(question);
                    break;
                default:
                    html += renderScenario(question);
            }
            
            html += `
                    </div>
                    <div class="btn-group">
                        ${currentQuestionIndex > 0 ? '<button class="btn btn-secondary" onclick="previousQuestion()">← Previous</button>' : ''}
                        <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn">
                            ${currentQuestionIndex === assessmentQuestions.length - 1 ? 'Complete Assessment' : 'Next →'}
                        </button>
                    </div>
                </div>
            `;
            
            return html;
        }

        // Question type renderers
        function renderVisualGrid(question) {
            let html = '<div class="visual-grid">';
            question.options.forEach((option, i) => {
                html += `
                    <div class="visual-option" data-value="${option.value}" onclick="selectVisualOption(this, ${question.multiSelect})">
                        <div class="visual-emoji">${option.emoji}</div>
                        <div class="visual-text">${option.text}</div>
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        function renderSlider(question) {
            const mid = (question.min + question.max) / 2;
            return `
                <div class="slider-container">
                    <div class="slider-track" id="sliderTrack">
                        <div class="slider-fill" id="sliderFill"></div>
                        <div class="slider-handle" id="sliderHandle" style="left: 50%;">
                            <div class="slider-value" id="sliderValue">${mid}</div>
                        </div>
                    </div>
                    <div class="slider-labels">
                        <span>${question.labels[0]}</span>
                        <span>${question.labels[1]}</span>
                        <span>${question.labels[2]}</span>
                    </div>
                    <input type="hidden" id="sliderInput" value="${mid}" min="${question.min}" max="${question.max}">
                </div>
            `;
        }

        function renderScenario(question) {
            let html = '<div class="scenario-options">';
            question.options.forEach((option, i) => {
                html += `
                    <div class="scenario-option visual-option" data-value="${option.value}" onclick="selectVisualOption(this, false)">
                        ${option.text}
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        function renderFrequencyGrid(question) {
            let html = '<div class="frequency-grid"><table class="frequency-table"><thead><tr><th></th>';
            question.scale.forEach(label => {
                html += `<th>${label}</th>`;
            });
            html += '</tr></thead><tbody>';
            
            question.items.forEach((item, itemIndex) => {
                html += `<tr><td>${item}</td>`;
                question.scale.forEach((label, scaleIndex) => {
                    html += `<td><div class="frequency-option" data-item="${itemIndex}" data-value="${scaleIndex}" onclick="selectFrequency(this, ${itemIndex})"></div></td>`;
                });
                html += '</tr>';
            });
            
            html += '</tbody></table></div>';
            return html;
        }

        function renderTimePreference(question) {
            let html = '<div class="time-options">';
            question.options.forEach(option => {
                html += `
                    <div class="time-option" data-value="${option.value}" onclick="selectVisualOption(this, false)">
                        <div class="time-icon">${option.icon}</div>
                        <div>${option.text}</div>
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        function renderTaskRanking(question) {
            let html = '<div class="ranking-container">';
            question.items.forEach((item, i) => {
                html += `
                    <div class="ranking-item" draggable="true" data-index="${i}">
                        <span class="ranking-number">${i + 1}</span>
                        <span class="ranking-text">${item}</span>
                        <span class="ranking-handle">☰</span>
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        function renderBodyMapping(question) {
            return `
                <div class="body-map">
                    <svg class="body-svg" viewBox="0 0 200 300">
                        <ellipse class="body-part" data-area="head" cx="100" cy="40" rx="25" ry="30"/>
                        <rect class="body-part" data-area="neck" x="90" y="65" width="20" height="20"/>
                        <rect class="body-part" data-area="shoulders" x="60" y="85" width="80" height="20"/>
                        <rect class="body-part" data-area="chest" x="75" y="105" width="50" height="40"/>
                        <rect class="body-part" data-area="stomach" x="75" y="145" width="50" height="40"/>
                        <rect class="body-part" data-area="back" x="80" y="85" width="40" height="100" opacity="0.5"/>
                        <rect class="body-part" data-area="limbs" x="50" y="105" width="20" height="80"/>
                        <rect class="body-part" data-area="limbs" x="130" y="105" width="20" height="80"/>
                        <rect class="body-part" data-area="limbs" x="80" y="185" width="15" height="80"/>
                        <rect class="body-part" data-area="limbs" x="105" y="185" width="15" height="80"/>
                    </svg>
                </div>
            `;
        }

        // Initialize question interactions
        function initializeQuestionInteractions(question) {
            if (question.type === 'slider') {
                initializeSlider(question);
            } else if (question.type === 'task_ranking') {
                initializeDragAndDrop();
            } else if (question.type === 'body_mapping') {
                initializeBodyMapping();
            }
        }

        // Initialize slider
        function initializeSlider(question) {
            const track = document.getElementById('sliderTrack');
            const handle = document.getElementById('sliderHandle');
            const fill = document.getElementById('sliderFill');
            const value = document.getElementById('sliderValue');
            const input = document.getElementById('sliderInput');
            
            let isDragging = false;
            
            handle.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
            
            handle.addEventListener('touchstart', startDrag);
            document.addEventListener('touchmove', drag);
            document.addEventListener('touchend', stopDrag);
            
            function startDrag(e) {
                isDragging = true;
                handle.style.cursor = 'grabbing';
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                const rect = track.getBoundingClientRect();
                const clientX = e.clientX || e.touches[0].clientX;
                let x = clientX - rect.left;
                x = Math.max(0, Math.min(x, rect.width));
                
                const percent = (x / rect.width) * 100;
                handle.style.left = `${percent}%`;
                fill.style.width = `${percent}%`;
                
                const val = Math.round(question.min + (percent / 100) * (question.max - question.min));
                value.textContent = val;
                input.value = val;
            }
            
            function stopDrag() {
                isDragging = false;
                handle.style.cursor = 'grab';
            }
        }

        // Initialize drag and drop
        function initializeDragAndDrop() {
            const items = document.querySelectorAll('.ranking-item');
            let draggedElement = null;
            
            items.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    draggedElement = e.target;
                    e.target.classList.add('dragging');
                });
                
                item.addEventListener('dragend', (e) => {
                    e.target.classList.remove('dragging');
                });
                
                item.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    const afterElement = getDragAfterElement(e.currentTarget.parentNode, e.clientY);
                    if (afterElement == null) {
                        e.currentTarget.parentNode.appendChild(draggedElement);
                    } else {
                        e.currentTarget.parentNode.insertBefore(draggedElement, afterElement);
                    }
                    updateRankingNumbers();
                });
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.ranking-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function updateRankingNumbers() {
            document.querySelectorAll('.ranking-item').forEach((item, index) => {
                item.querySelector('.ranking-number').textContent = index + 1;
            });
        }

        // Initialize body mapping
        function initializeBodyMapping() {
            document.querySelectorAll('.body-part').forEach(part => {
                part.addEventListener('click', function() {
                    this.classList.toggle('selected');
                });
            });
        }

        // Selection handlers
        function selectVisualOption(element, multiSelect) {
            if (multiSelect) {
                element.classList.toggle('selected');
            } else {
                document.querySelectorAll('.visual-option, .time-option').forEach(opt => opt.classList.remove('selected'));
                element.classList.add('selected');
            }
        }

        function selectFrequency(element, itemIndex) {
            document.querySelectorAll(`[data-item="${itemIndex}"]`).forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
        }

        // Navigation
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                saveResponse();
                showQuestion(currentQuestionIndex - 1);
            }
        }

        function nextQuestion() {
            saveResponse();
            
            if (currentQuestionIndex < assessmentQuestions.length - 1) {
                showQuestion(currentQuestionIndex + 1);
            } else {
                completeAssessment();
            }
        }

        // Save response
        function saveResponse() {
            const question = assessmentQuestions[currentQuestionIndex];
            const responseTime = Date.now() - questionStartTime;
            
            let response = {
                questionId: question.id,
                type: question.type,
                category: question.category,
                responseTime: responseTime,
                value: null
            };
            
            switch(question.type) {
                case 'visual_grid':
                case 'scenario':
                case 'time_preference':
                    const selected = document.querySelectorAll('.visual-option.selected, .time-option.selected');
                    if (question.multiSelect) {
                        response.value = Array.from(selected).map(el => el.dataset.value);
                    } else {
                        response.value = selected[0]?.dataset.value;
                    }
                    break;
                    
                case 'slider':
                    response.value = document.getElementById('sliderInput')?.value;
                    break;
                    
                case 'frequency_grid':
                    response.value = {};
                    document.querySelectorAll('.frequency-option.selected').forEach(opt => {
                        const item = question.items[opt.dataset.item];
                        response.value[item] = parseInt(opt.dataset.value);
                    });
                    break;
                    
                case 'task_ranking':
                    response.value = Array.from(document.querySelectorAll('.ranking-item')).map(
                        item => item.querySelector('.ranking-text').textContent
                    );
                    break;
                    
                case 'body_mapping':
                    response.value = Array.from(document.querySelectorAll('.body-part.selected')).map(
                        part => part.dataset.area
                    );
                    break;
            }
            
            responses[question.id] = response;
            questionStartTime = Date.now();
        }

        // Complete assessment
        function completeAssessment() {
            clearInterval(timeElapsedInterval);
            
            document.getElementById('assessmentContainer').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('loadingScreen').style.display = 'block';
            
            setTimeout(() => {
                const results = calculateResults();
                displayResults(results);
            }, 3000);
        }

        // Calculate results
        function calculateResults() {
            const totalTime = Date.now() - startTime;
            
            let scores = {
                openness: 50,
                conscientiousness: 50,
                extraversion: 50,
                agreeableness: 50,
                neuroticism: 50,
                honestyHumility: 50
            };
            
            let neuroScores = {
                autismTraits: 0,
                adhdTraits: 0,
                sensitivity: 0,
                executiveFunction: 50
            };
            
            Object.values(responses).forEach(response => {
                if (response.category && response.value) {
                    switch(response.category) {
                        case 'extraversion':
                        case 'openness':
                        case 'conscientiousness':
                        case 'agreeableness':
                        case 'neuroticism':
                            if (typeof response.value === 'number' || !isNaN(response.value)) {
                                scores[response.category] = (scores[response.category] + parseInt(response.value) * 10) / 2;
                            }
                            break;
                            
                        case 'adhd_attention':
                            neuroScores.adhdTraits += 20;
                            break;
                            
                        case 'asd_social':
                            neuroScores.autismTraits += 15;
                            break;
                            
                        case 'sensitivity':
                            neuroScores.sensitivity += 25;
                            break;
                    }
                }
            });
            
            // Find best matching profile
            let bestMatch = personalityProfiles[0];
            let bestScore = -1;
            
            personalityProfiles.forEach(profile => {
                let matchScore = 0;
                
                Object.keys(scores).forEach(trait => {
                    if (profile.traits[trait]) {
                        const diff = Math.abs(scores[trait] - profile.traits[trait].score);
                        matchScore += (100 - diff);
                    }
                });
                
                if (matchScore > bestScore) {
                    bestScore = matchScore;
                    bestMatch = profile;
                }
            });
            
            return {
                profile: bestMatch,
                scores: scores,
                neuroScores: neuroScores,
                totalTime: totalTime,
                responseCount: Object.keys(responses).length,
                matchConfidence: Math.min(95, Math.round((bestScore / 6)))
            };
        }

        // Display results
        function displayResults(results) {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'block';
            
            const container = document.getElementById('resultsContainer');
            
            let html = `
                <div class="results-header">
                    <h2 class="results-title">Your Personality Profile</h2>
                    <p style="color: var(--text-secondary); font-size: 1.125rem;">
                        Based on ${results.responseCount} responses over ${Math.round(results.totalTime / 60000)} minutes
                    </p>
                </div>
                
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-emoji">${results.profile.emoji}</div>
                        <div class="profile-info">
                            <h3 class="profile-name">${results.profile.name}</h3>
                            <p class="profile-description">${results.profile.description}</p>
                        </div>
                    </div>
                </div>
                
                <div class="traits-visualization">
                    <h3 style="font-size: 1.5rem; margin-bottom: 1.5rem; color: var(--neural-blue);">Personality Dimensions</h3>
                    <div class="trait-bars">
            `;
            
            Object.entries(results.scores).forEach(([trait, score]) => {
                const level = score > 70 ? 'high' : score > 40 ? 'medium' : 'low';
                html += `
                    <div class="trait-bar">
                        <div class="trait-name">${trait.charAt(0).toUpperCase() + trait.slice(1).replace(/([A-Z])/g, ' $1')}</div>
                        <div class="trait-progress">
                            <div class="trait-fill ${level}" style="width: ${score}%"></div>
                        </div>
                        <div class="trait-score">${Math.round(score)}</div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
                
                <div class="neuro-indicators">
                    <h3 style="font-size: 1.5rem; margin-bottom: 1rem; color: var(--neural-purple);">Neurodiversity Profile</h3>
                    <div class="neuro-grid">
                        <div class="neuro-indicator">
                            <div class="neuro-icon">🧠</div>
                            <div class="neuro-label">ADHD Traits</div>
                            <div class="neuro-value ${results.neuroScores.adhdTraits > 70 ? 'high' : results.neuroScores.adhdTraits > 40 ? 'medium' : 'low'}">${results.neuroScores.adhdTraits}%</div>
                        </div>
                        <div class="neuro-indicator">
                            <div class="neuro-icon">🧩</div>
                            <div class="neuro-label">Autism Traits</div>
                            <div class="neuro-value ${results.neuroScores.autismTraits > 70 ? 'high' : results.neuroScores.autismTraits > 40 ? 'medium' : 'low'}">${results.neuroScores.autismTraits}%</div>
                        </div>
                        <div class="neuro-indicator">
                            <div class="neuro-icon">🌺</div>
                            <div class="neuro-label">Sensitivity</div>
                            <div class="neuro-value ${results.neuroScores.sensitivity > 70 ? 'high' : results.neuroScores.sensitivity > 40 ? 'medium' : 'low'}">${results.neuroScores.sensitivity}%</div>
                        </div>
                        <div class="neuro-indicator">
                            <div class="neuro-icon">⚙️</div>
                            <div class="neuro-label">Executive Function</div>
                            <div class="neuro-value ${results.neuroScores.executiveFunction > 70 ? 'high' : results.neuroScores.executiveFunction > 40 ? 'medium' : 'low'}">${results.neuroScores.executiveFunction}%</div>
                        </div>
                    </div>
                </div>
                
                <div class="analysis-tabs">
                    <button class="tab-button active" onclick="switchTab('strengths')">Strengths</button>
                    <button class="tab-button" onclick="switchTab('growth')">Growth</button>
                    <button class="tab-button" onclick="switchTab('relationships')">Relationships</button>
                    <button class="tab-button" onclick="switchTab('career')">Career</button>
                </div>
                
                <div class="tab-content active" id="tab-strengths">
                    <div class="analysis-section">
                        <h3 class="analysis-title">Your Core Strengths</h3>
                        <div class="analysis-content">
                            <ul class="insight-list">
            `;
            
            if (results.profile.detailedAnalysis && results.profile.detailedAnalysis.strengths) {
                results.profile.detailedAnalysis.strengths.forEach(strength => {
                    html += `<li class="insight-item">${strength}</li>`;
                });
            }
            
            html += `
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="tab-growth">
                    <div class="analysis-section">
                        <h3 class="analysis-title">Growth Opportunities</h3>
                        <div class="analysis-content">
                            <p>${results.profile.detailedAnalysis?.growth || 'Continue leveraging your unique strengths while exploring new areas of growth.'}</p>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="tab-relationships">
                    <div class="analysis-section">
                        <h3 class="analysis-title">Relationship Insights</h3>
                        <div class="analysis-content">
                            <p>${results.profile.detailedAnalysis?.relationships || 'Build authentic connections that honor your personality.'}</p>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="tab-career">
                    <div class="analysis-section">
                        <h3 class="analysis-title">Career Paths</h3>
                        <div class="analysis-content">
                            <ul class="insight-list">
            `;
            
            if (results.profile.detailedAnalysis && results.profile.detailedAnalysis.career) {
                results.profile.detailedAnalysis.career.forEach(career => {
                    html += `<li class="insight-item">${career}</li>`;
                });
            }
            
            html += `
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="btn-group" style="margin-top: 3rem;">
                    <button class="btn btn-primary" onclick="downloadResults()">
                        <span>📥</span>
                        <span>Download Report</span>
                    </button>
                    <button class="btn btn-secondary" onclick="retakeAssessment()">
                        <span>🔄</span>
                        <span>Retake Assessment</span>
                    </button>
                </div>
            `;
            
            container.innerHTML = html;
            
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
            
            userProfile = results;
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        // Download results
        function downloadResults() {
            const report = {
                timestamp: new Date().toISOString(),
                profile: userProfile.profile,
                scores: userProfile.scores,
                neuroScores: userProfile.neuroScores,
                responses: responses
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `patricia-report-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Retake assessment
        function retakeAssessment() {
            currentQuestionIndex = 0;
            responses = {};
            startTime = null;
            questionStartTime = null;
            userProfile = null;
            
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('welcomeScreen').style.display = 'block';
            document.getElementById('progressBar').style.width = '0%';
        }

        // Initialize on load
        window.addEventListener('load', () => {
            initNeuralBackground();
        });
    </script>
</body>
</html>